<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ARGON | Configurar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Outfit', sans-serif; -webkit-tap-highlight-color: transparent; }
        .option-card { transition: all 0.2s ease; border: 2px solid #f4f4f5; cursor: pointer; }
        .selected { border-color: #92400e !important; background-color: #fffbeb !important; transform: scale(1.02); }
        .color-dot { width: 35px; height: 35px; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 0 1px rgba(0,0,0,0.1); margin: 0 auto; }
        .color-selected { outline: 2px solid #92400e; outline-offset: 3px; }
    </style>
</head>
<body class="bg-zinc-50 pb-32">

    <nav class="sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b border-zinc-100 p-4">
        <div class="max-w-2xl mx-auto flex items-center justify-between">
            <button onclick="history.back()" class="p-2"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M19 12H5M12 19l-7-7 7-7"/></svg></button>
            <div class="text-center">
                <span id="precio-display" class="block text-xl font-black text-amber-900">0 CUP</span>
                <span class="text-[9px] uppercase tracking-widest text-zinc-400 font-bold">Total Configurado</span>
            </div>
            <div class="w-10"></div>
        </div>
    </nav>

    <main class="max-w-2xl mx-auto p-4">
        <div class="bg-white rounded-[2.5rem] p-2 shadow-xl border border-zinc-100 mb-6">
            <div class="rounded-[2.2rem] overflow-hidden aspect-square bg-zinc-100">
                <img id="m-img" src="" class="w-full h-full object-cover">
            </div>
        </div>

        <h1 id="m-nombre" class="text-3xl font-black text-zinc-900 italic uppercase text-center mb-8">Cargando...</h1>

        <section class="mb-8">
            <h3 class="text-xs font-black uppercase tracking-widest text-zinc-400 mb-4 ml-2">1. Tipo de Madera</h3>
            <div class="grid grid-cols-3 gap-2">
                <div onclick="selectOption(this, 'madera', 'Pino', 0)" class="option-card bg-white p-3 rounded-2xl selected">
                    <span class="block font-bold text-sm">Pino</span>
                    <span class="text-[9px] text-zinc-400">Base</span>
                </div>
                <div onclick="selectOption(this, 'madera', 'Cedro', 15000)" class="option-card bg-white p-3 rounded-2xl">
                    <span class="block font-bold text-sm">Cedro</span>
                    <span class="text-[9px] text-amber-700">+15k CUP</span>
                </div>
                <div onclick="selectOption(this, 'madera', 'Caoba', 25000)" class="option-card bg-white p-3 rounded-2xl">
                    <span class="block font-bold text-sm">Caoba</span>
                    <span class="text-[9px] text-amber-700">+25k CUP</span>
                </div>
            </div>
        </section>

        <section class="mb-8">
            <h3 class="text-xs font-black uppercase tracking-widest text-zinc-400 mb-4 ml-2">2. Tipo de Tela</h3>
            <div class="grid grid-cols-2 gap-3">
                <div onclick="selectOption(this, 'tela', 'Microfibra', 0)" class="option-card bg-white p-4 rounded-2xl selected">
                    <span class="block font-bold">Microfibra</span>
                    <span class="text-[10px] text-zinc-400">Incluida</span>
                </div>
                <div onclick="selectOption(this, 'tela', 'Chenille', 8000)" class="option-card bg-white p-4 rounded-2xl">
                    <span class="block font-bold">Chenille</span>
                    <span class="text-[10px] text-amber-700">+8,000 CUP</span>
                </div>
                <div onclick="selectOption(this, 'tela', 'Polipiel', 10000)" class="option-card bg-white p-4 rounded-2xl">
                    <span class="block font-bold">Polipiel</span>
                    <span class="text-[10px] text-amber-700">+10,000 CUP</span>
                </div>
                <div onclick="selectOption(this, 'tela', 'Flexivinil', 12000)" class="option-card bg-white p-4 rounded-2xl">
                    <span class="block font-bold">Flexivinil</span>
                    <span class="text-[10px] text-amber-700">+12,000 CUP</span>
                </div>
                <div onclick="selectOption(this, 'tela', 'Tejido Saco', 6000)" class="option-card bg-white p-4 rounded-2xl col-span-2">
                    <span class="block font-bold">Tejido Saco</span>
                    <span class="text-[10px] text-amber-700">+6,000 CUP</span>
                </div>
            </div>
        </section>

        <section class="mb-8">
            <h3 class="text-xs font-black uppercase tracking-widest text-zinc-400 mb-4 ml-2">3. Color de Tela</h3>
            <div id="contenedor-colores" class="bg-white p-6 rounded-[2rem] border border-zinc-100 flex flex-wrap justify-center gap-6">
            </div>
        </section>
    </main>

    <div class="fixed bottom-0 left-0 right-0 p-4 bg-white border-t border-zinc-100">
        <button onclick="agregarAlCarrito()" class="w-full bg-zinc-900 text-white py-4 rounded-2xl font-bold shadow-xl">Añadir al Carrito</button>
    </div>

    <script>
        const PRECIO_BASE = 85000;
        let extraMadera = 0;
        let extraTela = 0;
        let seleccion = { nombre: "", img: "", madera: "Pino", tela: "Microfibra", color: "", precio: 0 };

        // Paletas de colores se mantienen igual...
        const paletas = {
            "juego-de-sala-armonia": [{ nombre: "Perla", clase: "bg-slate-200" }, { nombre: "Turquesa", clase: "bg-cyan-500" }],
            "juego-de-sala-chesterfield": [
                { nombre: "Crema", clase: "bg-[#F5F5DC]" }, { nombre: "Negro", clase: "bg-black" },
                { nombre: "Rojo Vino", clase: "bg-red-900" }, { nombre: "Verde Jade", clase: "bg-emerald-700" },
                { nombre: "Azul Brillante", clase: "bg-blue-600" }
            ],
            "Estandar": [{ nombre: "Gris", clase: "bg-zinc-500" }]
            // ... (puedes mantener el resto de tus paletas aquí)
        };

        function cargar() {
            const p = new URLSearchParams(window.location.search);
            let nombreRaw = p.get('nombre') || 'Mueble';
            const nombreClave = nombreRaw.toLowerCase().trim().replace(/\s+/g, '-').normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            
            seleccion.nombre = nombreRaw.replace(/-/g, ' ');
            seleccion.img = (p.get('img') || '').replace(/\|/g, '&');
            
            document.getElementById('m-nombre').innerText = seleccion.nombre;
            document.getElementById('m-img').src = seleccion.img;
            
            configurarColores(nombreClave);
            actualizarPrecio();
        }

        function configurarColores(clave) {
            const contenedor = document.getElementById('contenedor-colores');
            const listaColores = paletas[clave] || paletas["Estandar"];
            contenedor.innerHTML = ""; 
            listaColores.forEach(c => {
                const div = document.createElement('div');
                div.className = "text-center cursor-pointer";
                div.onclick = function() { selectColor(this, c.nombre) };
                div.innerHTML = `<div class="color-dot ${c.clase}"></div><span class="text-[9px] font-bold mt-2 block uppercase text-zinc-600">${c.nombre}</span>`;
                contenedor.appendChild(div);
            });
            if (listaColores.length === 1) selectColor(contenedor.firstChild, listaColores[0].nombre);
        }

        function selectOption(el, tipo, valor, extra) {
            el.parentElement.querySelectorAll('.option-card').forEach(c => c.classList.remove('selected'));
            el.classList.add('selected');
            seleccion[tipo] = valor;
            if(tipo === 'madera') extraMadera = extra;
            else extraTela = extra;
            actualizarPrecio();
        }

        function selectColor(el, valor) {
            if(!el) return;
            document.querySelectorAll('.color-dot').forEach(d => d.classList.remove('color-selected'));
            const dot = el.querySelector('.color-dot');
            if(dot) dot.classList.add('color-selected');
            seleccion.color = valor;
        }

        function actualizarPrecio() {
            seleccion.precio = PRECIO_BASE + extraMadera + extraTela;
            document.getElementById('precio-display').innerText = seleccion.precio.toLocaleString() + " CUP";
        }

        function agregarAlCarrito() {
            if(!seleccion.color) return alert("Por favor, elige un color antes de añadir.");
            let carrito = JSON.parse(localStorage.getItem('argon_cart')) || [];
            carrito.push(seleccion);
            localStorage.setItem('argon_cart', JSON.stringify(carrito));
            window.location.href = 'carrito.html';
        }
        
        window.onload = cargar;
    </script>
</body>
</html>