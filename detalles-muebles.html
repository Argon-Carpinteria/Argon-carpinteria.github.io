<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ARGON | Configurar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Outfit', sans-serif; -webkit-tap-highlight-color: transparent; }
        .option-card { transition: all 0.2s ease; border: 2px solid #f4f4f5; cursor: pointer; }
        .selected { border-color: #92400e !important; background-color: #fffbeb !important; transform: scale(1.02); }
        .color-dot { width: 35px; height: 35px; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 0 1px rgba(0,0,0,0.1); margin: 0 auto; }
        .color-selected { outline: 2px solid #92400e; outline-offset: 3px; }
        select { appearance: none; background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e"); background-repeat: no-repeat; background-position: right 1rem center; background-size: 1em; }
    </style>
</head>
<body class="bg-zinc-50 pb-32">

    <nav class="sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b border-zinc-100 p-4">
        <div class="max-w-2xl mx-auto flex items-center justify-between">
            <button onclick="history.back()" class="p-2"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M19 12H5M12 19l-7-7 7-7"/></svg></button>
            <div class="text-center">
                <span class="text-xs uppercase tracking-[0.2em] text-zinc-400 font-black">Configuración</span>
            </div>
            <div class="w-10"></div>
        </div>
    </nav>

    <main class="max-w-2xl mx-auto p-4">
        <div class="bg-white rounded-[2.5rem] p-2 shadow-xl border border-zinc-100 mb-4">
            <div class="rounded-[2.2rem] overflow-hidden aspect-square bg-zinc-100">
                <img id="m-img" src="" class="w-full h-full object-cover">
            </div>
        </div>

        <div class="text-center mb-8 px-4">
            <div id="m-precio-grande" class="text-4xl font-black text-zinc-900 mb-2">0 USD</div>
            <p class="text-amber-800 text-[11px] font-bold uppercase tracking-wider leading-tight">
                "Los muebles son por encargos en un plazo de 20 días hechos desde cero"
            </p>
        </div>

        <h1 id="m-nombre" class="text-3xl font-black text-zinc-900 italic uppercase text-center mb-8">Cargando...</h1>

        <section class="mb-8">
            <h3 class="text-xs font-black uppercase tracking-widest text-zinc-400 mb-4 ml-2">Selecciona tu Provincia</h3>
            <div class="relative">
                <select id="provincia-select" onchange="cambioProvincia(this.value)" class="w-full bg-white border-2 border-zinc-100 p-4 rounded-2xl font-bold text-zinc-700 outline-none focus:border-amber-700 transition-all">
                    <option value="" disabled selected>Elegir provincia...</option>
                    <option value="Pinar del Río">Pinar del Río</option>
                    <option value="Artemisa">Artemisa</option>
                    <option value="La Habana">La Habana (Transporte Incluido)</option>
                    <option value="Mayabeque">Mayabeque</option>
                    <option value="Matanzas">Matanzas</option>
                    <option value="Cienfuegos">Cienfuegos</option>
                    <option value="Villa Clara">Villa Clara</option>
                    <option value="Sancti Spíritus">Sancti Spíritus</option>
                    <option value="Ciego de Ávila">Ciego de Ávila</option>
                    <option value="Camagüey">Camagüey</option>
                    <option value="Las Tunas">Las Tunas</option>
                    <option value="Holguín">Holguín</option>
                    <option value="Granma">Granma</option>
                    <option value="Santiago de Cuba">Santiago de Cuba</option>
                    <option value="Guantánamo">Guantánamo</option>
                    <option value="Isla de la Juventud">Isla de la Juventud</option>
                </select>
            </div>
            <div id="mensaje-habana" class="hidden mt-2 ml-2 text-[10px] font-bold text-emerald-600 uppercase tracking-widest">
                ¡Felicidades! Tienes transporte gratis a domicilio.
            </div>
        </section>

        <section class="mb-8">
            <h3 class="text-xs font-black uppercase tracking-widest text-zinc-400 mb-4 ml-2">1. Tipo de Madera</h3>
            <div class="grid grid-cols-1 gap-2">
                <div class="option-card bg-white p-4 rounded-2xl selected">
                    <div class="flex justify-between items-center">
                        <div>
                            <span class="block font-bold text-sm">Algarrobo</span>
                            <span class="text-[9px] text-zinc-400 italic">Madera preciosa de alta durabilidad</span>
                        </div>
                        <span class="text-[10px] font-bold text-amber-700 uppercase">Seleccionado</span>
                    </div>
                </div>
            </div>
        </section>

        <section id="seccion-tipo-tela" class="mb-8">
            <h3 class="text-xs font-black uppercase tracking-widest text-zinc-400 mb-4 ml-2">2. Tipo de Tela</h3>
            <div class="grid grid-cols-2 gap-3">
                <div onclick="selectOption(this, 'tela', 'Microfibra')" class="option-card bg-white p-4 rounded-2xl selected">
                    <span class="block font-bold">Microfibra</span>
                </div>
                <div onclick="selectOption(this, 'tela', 'Chenille')" class="option-card bg-white p-4 rounded-2xl">
                    <span class="block font-bold">Chenille</span>
                </div>
                <div onclick="selectOption(this, 'tela', 'Polipiel')" class="option-card bg-white p-4 rounded-2xl">
                    <span class="block font-bold">Polipiel</span>
                </div>
                <div onclick="selectOption(this, 'tela', 'Flexivinil')" class="option-card bg-white p-4 rounded-2xl">
                    <span class="block font-bold">Flexivinil</span>
                </div>
                <div onclick="selectOption(this, 'tela', 'Tejido Saco')" class="option-card bg-white p-4 rounded-2xl col-span-2 text-center">
                    <span class="block font-bold">Tejido Saco</span>
                </div>
            </div>
        </section>

        <section id="seccion-color" class="mb-8">
            <h3 class="text-xs font-black uppercase tracking-widest text-zinc-400 mb-4 ml-2">3. Color de Tela</h3>
            <div id="contenedor-colores" class="bg-white p-6 rounded-[2rem] border border-zinc-100 flex flex-wrap justify-center gap-6">
            </div>
        </section>
    </main>

    <div class="fixed bottom-0 left-0 right-0 p-4 bg-white border-t border-zinc-100">
        <button onclick="agregarAlCarrito()" class="w-full bg-zinc-900 text-white py-4 rounded-2xl font-bold shadow-xl">Añadir al Carrito</button>
    </div>

    <script>
        let PRECIO_BASE = 850; 
        let seleccion = { nombre: "", img: "", madera: "Algarrobo", tela: "Microfibra", color: "", provincia: "", precio: 0, transporte: "No incluido" };

        const paletas = {
            "Estandar": [
                { nombre: "Gris", clase: "bg-zinc-500" },
                { nombre: "Crema", clase: "bg-[#F5F5DC]" },
                { nombre: "Chocolate", clase: "bg-[#3d1c02]" },
                { nombre: "Arena", clase: "bg-[#C2B280]" }
            ]
        };

        function cargar() {
            const p = new URLSearchParams(window.location.search);
            const productoGuardado = localStorage.getItem('argon_temp_product');

            if (p.has('nombre')) {
                let nombreRaw = p.get('nombre') || 'Mueble';
                seleccion.nombre = nombreRaw.replace(/-/g, ' ');
                seleccion.img = (p.get('img') || '').replace(/\|/g, '&');
            } else if (productoGuardado) {
                const producto = JSON.parse(productoGuardado);
                seleccion.nombre = producto.nombre;
                seleccion.img = producto.imagen;
                PRECIO_BASE = producto.precio;
            }

            gestionarOpcionesProducto(seleccion.nombre);

            document.getElementById('m-nombre').innerText = seleccion.nombre;
            document.getElementById('m-img').src = seleccion.img;
            
            const claveFinal = seleccion.nombre.toLowerCase().trim().replace(/\s+/g, '-').normalize("NFD").replace(/[\u0300-\u036f]/g, "");
            configurarColores(claveFinal);
            actualizarPrecio();
        }

        function gestionarOpcionesProducto(nombre) {
            const nombreNormalizado = nombre.toLowerCase();
            const seccionTela = document.getElementById('seccion-tipo-tela');
            const seccionColor = document.getElementById('seccion-color');
            
            // FILTRO PARA PRODUCTOS SIN TELA: Aparadores, Estantes, Puertas y MULTIMUEBLES
            if (nombreNormalizado.includes("aparador") || 
                nombreNormalizado.includes("estante") || 
                nombreNormalizado.includes("puerta") || 
                nombreNormalizado.includes("multimueble")) {
                
                seccionTela.style.display = "none";
                seccionColor.style.display = "none";
                seleccion.tela = "N/A";
                seleccion.color = "Acabado Madera";
                return;
            }

            // Detección para CAMAS específicas sin tela
            if (nombreNormalizado.includes("camas")) {
                const camasSinTela = ["11", "21", "23"];
                const numeroCama = nombreNormalizado.replace("camas-", "").replace("camas", "").trim();
                if (camasSinTela.includes(numeroCama)) {
                    seccionTela.style.display = "none";
                    seccionColor.style.display = "none";
                    seleccion.tela = "Madera Vista";
                    seleccion.color = "Barniz Algarrobo";
                    return;
                }
            }

            // Detección para MESAS
            if (nombreNormalizado.includes("mesa")) {
                const numerosConTela = ["1", "2", "4", "7", "9", "13", "14", "15", "16", "17"];
                const numeroExtraido = nombreNormalizado.replace("mesa-", "").replace("mesa", "").trim();
                if (numerosConTela.includes(numeroExtraido)) {
                    seccionTela.style.display = "block";
                    seccionColor.style.display = "block";
                } else {
                    seccionTela.style.display = "none";
                    seccionColor.style.display = "none";
                    seleccion.tela = "Madera Vista";
                    seleccion.color = "Barniz Natural";
                }
            } else {
                // Sofás y otros productos que sí llevan tela
                seccionTela.style.display = "block";
                seccionColor.style.display = "block";
            }
        }

        function cambioProvincia(valor) {
            seleccion.provincia = valor;
            const msg = document.getElementById('mensaje-habana');
            if (valor === "La Habana") {
                seleccion.transporte = "Gratis";
                msg.classList.remove('hidden');
            } else {
                seleccion.transporte = "A consultar";
                msg.classList.add('hidden');
            }
        }

        function selectOption(el, tipo, valor) {
            el.parentElement.querySelectorAll('.option-card').forEach(c => c.classList.remove('selected'));
            el.classList.add('selected');
            seleccion[tipo] = valor;
        }

        function configurarColores(clave) {
            const contenedor = document.getElementById('contenedor-colores');
            const listaColores = paletas[clave] || paletas["Estandar"];
            contenedor.innerHTML = ""; 
            listaColores.forEach(c => {
                const div = document.createElement('div');
                div.className = "text-center cursor-pointer";
                div.onclick = function() { selectColor(this, c.nombre) };
                div.innerHTML = `<div class="color-dot ${c.clase}"></div><span class="text-[9px] font-bold mt-2 block uppercase text-zinc-600">${c.nombre}</span>`;
                contenedor.appendChild(div);
            });
        }

        function selectColor(el, valor) {
            document.querySelectorAll('.color-dot').forEach(d => d.classList.remove('color-selected'));
            el.querySelector('.color-dot').classList.add('color-selected');
            seleccion.color = valor;
        }

        function actualizarPrecio() {
            seleccion.precio = PRECIO_BASE;
            const formato = seleccion.precio.toLocaleString('en-US') + " USD";
            document.getElementById('m-precio-grande').innerText = formato;
        }

        function agregarAlCarrito() {
            if(!seleccion.provincia) return alert("Por favor, selecciona tu provincia.");
            
            const seccionColor = document.getElementById('seccion-color');
            if(seccionColor.style.display !== "none" && !seleccion.color) {
                return alert("Por favor, elige un color de tela.");
            }
            
            let carrito = JSON.parse(localStorage.getItem('argon_cart')) || [];
            carrito.push(seleccion);
            localStorage.setItem('argon_cart', JSON.stringify(carrito));
            window.location.href = 'carrito.html';
        }
        
        window.onload = cargar;
    </script>
</body>
</html>